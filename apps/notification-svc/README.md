# Notification Service

–°–µ—Ä–≤–∏—Å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º–∏, —à–∞–±–ª–æ–Ω–∞–º–∏ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.

## üöÄ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è**: –°–æ–∑–¥–∞–Ω–∏–µ, –æ—Ç–ø—Ä–∞–≤–∫–∞ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º–∏
- **–®–∞–±–ª–æ–Ω—ã**: –°–æ–∑–¥–∞–Ω–∏–µ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —à–∞–±–ª–æ–Ω–∞–º–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- **–ù–∞—Å—Ç—Ä–æ–π–∫–∏**: –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- **–û—á–µ—Ä–µ–¥—å**: –°–∏—Å—Ç–µ–º–∞ –æ—á–µ—Ä–µ–¥–∏ –¥–ª—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞**: –î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º –∏ —à–∞–±–ª–æ–Ω–∞–º

## üìã –¢–∏–ø—ã —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

- **Email**: –≠–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞—è –ø–æ—á—Ç–∞
- **Push**: Push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- **SMS**: SMS —Å–æ–æ–±—â–µ–Ω–∏—è
- **In-App**: –í–Ω—É—Ç—Ä–∏–ø—Ä–∏–ª–æ–∂–µ–Ω–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

## üõ†Ô∏è –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Python 3.11+
- PostgreSQL 13+
- Redis (–¥–ª—è –±—É–¥—É—â–µ–π –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏)

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
pip install -r requirements.txt
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

1. –°–æ–∑–¥–∞–π—Ç–µ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö PostgreSQL:
```sql
CREATE DATABASE notification_db;
```

2. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ñ–∞–π–ª –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:
```bash
cp env.example .env
```

3. –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `.env` —Ñ–∞–π–ª —Å –≤–∞—à–∏–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏

4. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏:
```bash
alembic upgrade head
```

### –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–∞

```bash
uvicorn app.main:app --host 0.0.0.0 --port 8009 --reload
```

## üìö API –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–∏—Å–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –¥–æ—Å—Ç—É–ø–Ω–∞ –ø–æ –∞–¥—Ä–µ—Å—É:
- Swagger UI: http://localhost:8009/docs
- ReDoc: http://localhost:8009/redoc

## üîß –û—Å–Ω–æ–≤–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã

### –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- `POST /api/v1/notifications` - –°–æ–∑–¥–∞–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- `POST /api/v1/notifications/from-template` - –°–æ–∑–¥–∞–Ω–∏–µ –∏–∑ —à–∞–±–ª–æ–Ω–∞
- `GET /api/v1/notifications` - –ü–æ–ª—É—á–µ–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `GET /api/v1/notifications/{id}` - –ü–æ–ª—É—á–µ–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø–æ ID
- `POST /api/v1/notifications/{id}/send` - –û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

### –®–∞–±–ª–æ–Ω—ã
- `POST /api/v1/templates` - –°–æ–∑–¥–∞–Ω–∏–µ —à–∞–±–ª–æ–Ω–∞
- `GET /api/v1/templates` - –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —à–∞–±–ª–æ–Ω–æ–≤
- `GET /api/v1/templates/{id}` - –ü–æ–ª—É—á–µ–Ω–∏–µ —à–∞–±–ª–æ–Ω–∞ –ø–æ ID
- `PUT /api/v1/templates/{id}` - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —à–∞–±–ª–æ–Ω–∞
- `DELETE /api/v1/templates/{id}` - –£–¥–∞–ª–µ–Ω–∏–µ —à–∞–±–ª–æ–Ω–∞
- `POST /api/v1/templates/{id}/render` - –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ —à–∞–±–ª–æ–Ω–∞

### –ù–∞—Å—Ç—Ä–æ–π–∫–∏
- `GET /api/v1/settings` - –ü–æ–ª—É—á–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `POST /api/v1/settings` - –°–æ–∑–¥–∞–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫
- `PUT /api/v1/settings` - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫
- `DELETE /api/v1/settings` - –£–¥–∞–ª–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫
- `POST /api/v1/settings/reset` - –°–±—Ä–æ—Å –∫ –∑–Ω–∞—á–µ–Ω–∏—è–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

### –û—á–µ—Ä–µ–¥—å
- `POST /api/v1/queue` - –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ –æ—á–µ—Ä–µ–¥—å
- `GET /api/v1/queue` - –ü–æ–ª—É—á–µ–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –æ—á–µ—Ä–µ–¥–∏
- `POST /api/v1/queue/process-batch` - –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–∞–∫–µ—Ç–∞
- `GET /api/v1/queue/stats` - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ—á–µ—Ä–µ–¥–∏

## üóÑÔ∏è –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö

### NotificationTemplate
- `id`: –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä
- `name`: –ù–∞–∑–≤–∞–Ω–∏–µ —à–∞–±–ª–æ–Ω–∞
- `notification_type`: –¢–∏–ø —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- `content`: –°–æ–¥–µ—Ä–∂–∏–º–æ–µ —à–∞–±–ª–æ–Ω–∞
- `subject`: –¢–µ–º–∞ (–¥–ª—è email)
- `variables`: –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –ø–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–∏
- `is_active`: –ê–∫—Ç–∏–≤–Ω—ã–π —à–∞–±–ª–æ–Ω

### Notification
- `id`: –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä
- `user_id`: ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `template_id`: ID —à–∞–±–ª–æ–Ω–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- `notification_type`: –¢–∏–ø —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- `content`: –°–æ–¥–µ—Ä–∂–∏–º–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- `status`: –°—Ç–∞—Ç—É—Å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- `priority`: –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç
- `scheduled_at`: –í—Ä–µ–º—è –æ—Ç–ø—Ä–∞–≤–∫–∏

### NotificationSettings
- `id`: –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä
- `user_id`: ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `email_enabled`: –í–∫–ª—é—á–µ–Ω—ã –ª–∏ email —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- `push_enabled`: –í–∫–ª—é—á–µ–Ω—ã –ª–∏ push —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- `sms_enabled`: –í–∫–ª—é—á–µ–Ω—ã –ª–∏ SMS —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- `in_app_enabled`: –í–∫–ª—é—á–µ–Ω—ã –ª–∏ –≤–Ω—É—Ç—Ä–∏–ø—Ä–∏–ª–æ–∂–µ–Ω–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- `marketing_emails`: –í–∫–ª—é—á–µ–Ω—ã –ª–∏ –º–∞—Ä–∫–µ—Ç–∏–Ω–≥–æ–≤—ã–µ –ø–∏—Å—å–º–∞
- `system_notifications`: –í–∫–ª—é—á–µ–Ω—ã –ª–∏ —Å–∏—Å—Ç–µ–º–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- `security_alerts`: –í–∫–ª—é—á–µ–Ω—ã –ª–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- `billing_notifications`: –í–∫–ª—é—á–µ–Ω—ã –ª–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –±–∏–ª–ª–∏–Ω–≥–µ

### NotificationQueue
- `id`: –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä
- `notification_id`: ID —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- `priority`: –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç
- `scheduled_at`: –í—Ä–µ–º—è –æ—Ç–ø—Ä–∞–≤–∫–∏
- `attempts`: –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ø—ã—Ç–æ–∫
- `max_attempts`: –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ø—ã—Ç–æ–∫
- `is_processing`: –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –ª–∏ —Å–µ–π—á–∞—Å

## üîÑ –°—Ç–∞—Ç—É—Å—ã —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

- `pending`: –û–∂–∏–¥–∞–µ—Ç –æ—Ç–ø—Ä–∞–≤–∫–∏
- `sent`: –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ
- `delivered`: –î–æ—Å—Ç–∞–≤–ª–µ–Ω–æ
- `failed`: –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏
- `cancelled`: –û—Ç–º–µ–Ω–µ–Ω–æ

## ‚ö° –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

- `low`: –ù–∏–∑–∫–∏–π
- `normal`: –û–±—ã—á–Ω—ã–π
- `high`: –í—ã—Å–æ–∫–∏–π
- `urgent`: –°—Ä–æ—á–Ω—ã–π

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤
pytest

# –ó–∞–ø—É—Å–∫ —Å –ø–æ–∫—Ä—ã—Ç–∏–µ–º
pytest --cov=app
```

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### Health Check
- `GET /api/v1/health` - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–µ—Ä–≤–∏—Å–∞
- `GET /api/v1/health/db` - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
- `GET /api/v1/notifications/me/stats` - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `GET /api/v1/templates/stats` - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —à–∞–±–ª–æ–Ω–æ–≤
- `GET /api/v1/settings/stats` - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫
- `GET /api/v1/queue/stats` - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ—á–µ—Ä–µ–¥–∏

## üîÆ –ü–ª–∞–Ω—ã —Ä–∞–∑–≤–∏—Ç–∏—è

- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å email –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞–º–∏ (SendGrid, Mailgun)
- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º–∏ (Firebase, APNs)
- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å SMS –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞–º–∏
- [ ] –°–∏—Å—Ç–µ–º–∞ –æ—á–µ—Ä–µ–¥–µ–π —Å Redis/RabbitMQ
- [ ] –í–µ–±-—Ö—É–∫–∏ –¥–ª—è –≤–Ω–µ—à–Ω–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
- [ ] A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —à–∞–±–ª–æ–Ω–æ–≤
- [ ] –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –¥–æ—Å—Ç–∞–≤–ª—è–µ–º–æ—Å—Ç–∏
- [ ] –ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

## ü§ù –í–∫–ª–∞–¥ –≤ –ø—Ä–æ–µ–∫—Ç

1. –§–æ—Ä–∫–Ω–∏—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
2. –°–æ–∑–¥–∞–π—Ç–µ –≤–µ—Ç–∫—É –¥–ª—è –Ω–æ–≤–æ–π —Ñ—É–Ω–∫—Ü–∏–∏
3. –í–Ω–µ—Å–∏—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
4. –î–æ–±–∞–≤—å—Ç–µ —Ç–µ—Å—Ç—ã
5. –°–æ–∑–¥–∞–π—Ç–µ Pull Request

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

MIT License
