# StoryQR Admin Panel

–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω–∞—è –ø–∞–Ω–µ–ª—å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–æ–º StoryQR.

## –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

- **Next.js 14** (App Router)
- **TypeScript** (—Å—Ç—Ä–æ–≥–∏–π —Ä–µ–∂–∏–º)
- **Tailwind CSS** + **Radix UI**
- **TanStack Query** (React Query)
- **MSW** (Mock Service Worker)
- **Playwright** (E2E —Ç–µ—Å—Ç—ã)
- **Vitest** (Unit —Ç–µ—Å—Ç—ã)

## –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

### üîê –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ RBAC
- JWT –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —Å —Ä–æ–ª—è–º–∏
- –†–æ–ª–∏: `superadmin`, `ops`, `support`, `sales`, `moderator`, `analyst`, `printer`
- –ó–∞—â–∏—â–µ–Ω–Ω—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã –ø–æ —Ä–æ–ª—è–º

### üìä Dashboard
- KPI –∫–∞—Ä—Ç–æ—á–∫–∏ (–≤—ã—Ä—É—á–∫–∞, –∑–∞–∫–∞–∑—ã, —Ç—Ä–∏–∞–ª—ã, —Å–æ–±—ã—Ç–∏—è)
- –ì—Ä–∞—Ñ–∏–∫–∏ –≤—ã—Ä—É—á–∫–∏ –ø–æ –¥–Ω—è–º
- –°–ø–∏—Å–∫–∏ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ (—Å–æ–±—ã—Ç–∏—è, —Ç–∏–∫–µ—Ç—ã, –ø–µ—á–∞—Ç–Ω—ã–µ –∑–∞–∫–∞–∑—ã)

### üë• –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
- –ü–æ–∏—Å–∫ –∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –ü—Ä–æ—Å–º–æ—Ç—Ä –ø—Ä–æ—Ñ–∏–ª–µ–π –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
- –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞/—Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ä–æ–ª–µ–π
- –ò–º–ø–µ—Ä—Å–æ–Ω–∞—Ü–∏—è (—Ç–æ–ª—å–∫–æ superadmin)

### üìÖ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è–º–∏
- –ü—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ—Ö —Å–æ–±—ã—Ç–∏–π —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–ª–∞–Ω–∞–º–∏ –∏ —Å—Ä–æ–∫–∞–º–∏ —Ö—Ä–∞–Ω–µ–Ω–∏—è
- –ö–æ–Ω—Ç—Ä–æ–ª—å –≤–∏–¥–∏–º–æ—Å—Ç–∏ –∏ PIN-–∫–æ–¥–æ–≤
- –≠–∫—Å–ø–æ—Ä—Ç ZIP –∞—Ä—Ö–∏–≤–æ–≤
- –ü—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–∫–∞/–≤–æ–∑–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–≥—Ä—É–∑–æ–∫

### üñºÔ∏è –ú–æ–¥–µ—Ä–∞—Ü–∏—è –º–µ–¥–∏–∞
- –û—á–µ—Ä–µ–¥—å –º–æ–¥–µ—Ä–∞—Ü–∏–∏ (flagged/new)
- –ü—Ä–æ—Å–º–æ—Ç—Ä –ø—Ä–µ–≤—å—é –∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö
- –û–¥–æ–±—Ä–µ–Ω–∏–µ/–æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ/—É–¥–∞–ª–µ–Ω–∏–µ
- –ü–æ–≤—Ç–æ—Ä–Ω–æ–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
- –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∑–∞–≥—Ä—É–∑—á–∏–∫–æ–≤

### üí≥ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞–º–∏
- –ü—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ—Ö –∑–∞–∫–∞–∑–æ–≤ –∏ –ø–ª–∞—Ç–µ–∂–µ–π
- –†—É—á–Ω–∞—è –æ—Ç–º–µ—Ç–∫–∞ –æ–ø–ª–∞—Ç—ã
- –í–æ–∑–≤—Ä–∞—Ç—ã (–ø–æ–ª–Ω—ã–µ/—á–∞—Å—Ç–∏—á–Ω—ã–µ)
- –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ —á–µ–∫–æ–≤
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –ø–ª–∞—Ç–µ–∂–Ω—ã–º–∏ —Å–∏—Å—Ç–µ–º–∞–º–∏

### üñ®Ô∏è –ü–µ—á–∞—Ç–Ω—ã–µ –∑–∞–∫–∞–∑—ã
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞–º–∏ –Ω–∞ –ø–µ—á–∞—Ç—å
- –°—Ç–∞—Ç—É—Å—ã: new/processing/shipped/delivered/cancelled
- –≠–∫—Å–ø–æ—Ä—Ç –¥–ª—è —Ç–∏–ø–æ–≥—Ä–∞—Ñ–∏–∏
- –ü–µ—á–∞—Ç—å —ç—Ç–∏–∫–µ—Ç–æ–∫
- –¢—Ä–µ–∫–∏–Ω–≥ –¥–æ—Å—Ç–∞–≤–∫–∏

### üìà –ê–Ω–∞–ª–∏—Ç–∏–∫–∞
- –û–±–∑–æ—Ä–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏
- –í—ã—Ä—É—á–∫–∞ –ø–æ –¥–Ω—è–º/–Ω–µ–¥–µ–ª—è–º/–º–µ—Å—è—Ü–∞–º
- –í–æ—Ä–æ–Ω–∫–∏ –∫–æ–Ω–≤–µ—Ä—Å–∏–∏
- –ö–æ–≥–æ—Ä—Ç–Ω—ã–π –∞–Ω–∞–ª–∏–∑
- –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö

### ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏
- **–¢–∞—Ä–∏—Ñ—ã**: —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–ª–∞–Ω–æ–≤ –∏ —Ü–µ–Ω
- **–¢—Ä–∏–∞–ª**: –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–Ω–µ–π –∏ –ª–∏–º–∏—Ç–æ–≤
- **–î–æ–º–µ–Ω—ã**: —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—Å–Ω–æ–≤–Ω—ã–º–∏ –∏ –∫–æ—Ä–æ—Ç–∫–∏–º–∏ –¥–æ–º–µ–Ω–∞–º–∏
- **–§–ª–∞–≥–∏**: –≤–∫–ª—é—á–µ–Ω–∏–µ/–≤—ã–∫–ª—é—á–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–π

### üîß –°–∏—Å—Ç–µ–º–∞
- **–õ–æ–≥–∏**: –ø—Ä–æ—Å–º–æ—Ç—Ä —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –ª–æ–≥–æ–≤
- **Webhooks**: –∂—É—Ä–Ω–∞–ª –∏ –ø–æ–≤—Ç–æ—Ä–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞
- **Rate Limits**: —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞–º–∏
- **–û—á–µ—Ä–µ–¥–∏**: –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ Celery/Rabbit

### üé´ –ü–æ–¥–¥–µ—Ä–∂–∫–∞
- –¢–∏–∫–µ—Ç—ã –ø–æ–¥–¥–µ—Ä–∂–∫–∏
- –ë—ã—Å—Ç—Ä—ã–µ –æ—Ç–≤–µ—Ç—ã
- –°–≤—è–∑—å —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏/—Å–æ–±—ã—Ç–∏—è–º–∏/–∑–∞–∫–∞–∑–∞–º–∏

### üîç –ê—É–¥–∏—Ç
- –õ–æ–≥ –≤—Å–µ—Ö –¥–µ–π—Å—Ç–≤–∏–π –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤
- –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é/–¥–µ–π—Å—Ç–≤–∏—é/–¥–∞—Ç–µ
- –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫

### –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
npm install

# –°–æ–∑–¥–∞–Ω–∏–µ .env.local
cp env.example .env.local

# –ó–∞–ø—É—Å–∫ –≤ —Ä–µ–∂–∏–º–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
npm run dev
```

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```env
# Admin API Base URL
NEXT_PUBLIC_ADMIN_API_BASE_URL=http://localhost:8080/admin-api/v1

# Public URLs
NEXT_PUBLIC_PUBLIC_BASE_URL=https://storyqr.ru
NEXT_PUBLIC_SHORT_BASE_URL=https://sqra.ru

# Development flags
NEXT_PUBLIC_USE_MOCKS=true
NEXT_PUBLIC_DEBUG_MODE=false
```

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# Unit —Ç–µ—Å—Ç—ã
npm run test

# E2E —Ç–µ—Å—Ç—ã
npm run test:e2e

# E2E —Ç–µ—Å—Ç—ã —Å UI
npm run test:e2e:ui
```

### –°–±–æ—Ä–∫–∞

```bash
# Production —Å–±–æ—Ä–∫–∞
npm run build

# –ó–∞–ø—É—Å–∫ production —Å–µ—Ä–≤–µ—Ä–∞
npm run start
```

## API Endpoints

–í—Å–µ API endpoints –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ `lib/endpoints.ts`:

- **Auth**: `/auth/login`, `/auth/me`
- **Users**: `/users`, `/users/{id}`, `/users/{id}/ban`, etc.
- **Events**: `/events`, `/events/{id}`, `/events/{id}/plan`, etc.
- **Media**: `/media/moderation`, `/media/{id}/approve`, etc.
- **Orders**: `/orders`, `/orders/{id}`, `/orders/{id}/refund`, etc.
- **Analytics**: `/analytics/overview`, `/analytics/revenue`, etc.
- **Settings**: `/settings/pricing`, `/settings/trial`, etc.

## MSW –ú–æ–∫–∏

–í —Ä–µ–∂–∏–º–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ —Å `NEXT_PUBLIC_USE_MOCKS=true` –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è MSW –º–æ–∫–∏:

- –ü–æ–ª–Ω—ã–µ –º–æ–∫–∏ –¥–ª—è –≤—Å–µ—Ö API endpoints
- –†–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã–µ —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤—Å–µ—Ö CRUD –æ–ø–µ—Ä–∞—Ü–∏–π
- –≠–º—É–ª—è—Ü–∏—è –æ—à–∏–±–æ–∫ –∏ –∑–∞–¥–µ—Ä–∂–µ–∫

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
apps/admin/
‚îú‚îÄ‚îÄ app/                    # Next.js App Router
‚îÇ   ‚îú‚îÄ‚îÄ dashboard/         # Dashboard —Å—Ç—Ä–∞–Ω–∏—Ü–∞
‚îÇ   ‚îú‚îÄ‚îÄ users/            # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
‚îÇ   ‚îú‚îÄ‚îÄ events/           # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è–º–∏
‚îÇ   ‚îú‚îÄ‚îÄ analytics/        # –ê–Ω–∞–ª–∏—Ç–∏–∫–∞
‚îÇ   ‚îú‚îÄ‚îÄ settings/         # –ù–∞—Å—Ç—Ä–æ–π–∫–∏
‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îú‚îÄ‚îÄ components/           # React –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ ui/              # –ë–∞–∑–æ–≤—ã–µ UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ nav/             # –ù–∞–≤–∏–≥–∞—Ü–∏—è
‚îÇ   ‚îî‚îÄ‚îÄ layout/          # Layout –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
‚îú‚îÄ‚îÄ lib/                 # –£—Ç–∏–ª–∏—Ç—ã –∏ API
‚îÇ   ‚îú‚îÄ‚îÄ mocks/           # MSW –º–æ–∫–∏
‚îÇ   ‚îú‚îÄ‚îÄ adminApi.ts      # API –∫–ª–∏–µ–Ω—Ç
‚îÇ   ‚îú‚îÄ‚îÄ endpoints.ts     # API endpoints
‚îÇ   ‚îú‚îÄ‚îÄ rbac.ts          # RBAC –ª–æ–≥–∏–∫–∞
‚îÇ   ‚îî‚îÄ‚îÄ utils.ts         # –£—Ç–∏–ª–∏—Ç—ã
‚îî‚îÄ‚îÄ tests/               # –¢–µ—Å—Ç—ã
    ‚îú‚îÄ‚îÄ e2e/            # Playwright E2E —Ç–µ—Å—Ç—ã
    ‚îî‚îÄ‚îÄ setup.ts        # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç–µ—Å—Ç–æ–≤
```

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- –í—Å–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∏–º–µ—é—Ç `noindex` –∑–∞–≥–æ–ª–æ–≤–∫–∏
- JWT —Ç–æ–∫–µ–Ω—ã —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ localStorage
- RBAC –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ –∏ —Å–µ—Ä–≤–µ—Ä–µ
- CSRF –∑–∞—â–∏—Ç–∞ —á–µ—Ä–µ–∑ SameSite cookies
- –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Å–µ—Ö –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

## –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

- Server-side —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥ –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –∑–∞–≥—Ä—É–∑–∫–∏
- –í–∏—Ä—Ç—É–∞–ª–∏–∑–∞—Ü–∏—è –±–æ–ª—å—à–∏—Ö —Ç–∞–±–ª–∏—Ü
- Lazy loading –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ API –∑–∞–ø—Ä–æ—Å–æ–≤

## –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å

- –ü–æ–ª–Ω–∞—è –∫–ª–∞–≤–∏–∞—Ç—É—Ä–Ω–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è
- ARIA –∞—Ç—Ä–∏–±—É—Ç—ã
- –í—ã—Å–æ–∫–∏–π –∫–æ–Ω—Ç—Ä–∞—Å—Ç
- Screen reader –ø–æ–¥–¥–µ—Ä–∂–∫–∞
- WCAG AA —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ

## –î–æ—Ä–∞–±–æ—Ç–∫–∏ –±—ç–∫–∞

–î–ª—è –ø–æ–ª–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å:

1. **Admin Gateway** (`/admin-api/v1`) - –ø—Ä–æ–∫—Å–∏ –∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º —Å–µ—Ä–≤–∏—Å–∞–º
2. **Audit Log** - –∑–∞–ø–∏—Å—å –¥–µ–π—Å—Ç–≤–∏–π –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤
3. **Orders/Refunds** - –º–µ—Ç–æ–¥—ã `mark-paid`, `refund`, `resend-receipt`
4. **Print Pipeline** - —Å—Ç–∞—Ç—É—Å—ã –∏ —ç–∫—Å–ø–æ—Ä—Ç –ø–µ—á–∞—Ç–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤
5. **Analytics Aggregates** - –∞–≥—Ä–µ–≥–∞—Ç—ã –ø–æ –≤—ã—Ä—É—á–∫–µ/–≤–æ—Ä–æ–Ω–∫–∞–º/–∫–æ–æ—Ä—Ç–∞–º
6. **System Monitoring** - –æ–±—ë—Ä—Ç–∫–∏ –≤–æ–∫—Ä—É–≥ Loki/Rabbit/–≤–µ–±—Ö—É–∫–æ–≤

## –õ–∏—Ü–µ–Ω–∑–∏—è

MIT License


